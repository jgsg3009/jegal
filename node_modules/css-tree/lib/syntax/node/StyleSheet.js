<<<<<<< HEAD
=======
var List = require('../../utils/list');
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
var TYPE = require('../../tokenizer').TYPE;

var WHITESPACE = TYPE.WhiteSpace;
var COMMENT = TYPE.Comment;
<<<<<<< HEAD
var ATKEYWORD = TYPE.AtKeyword;
var CDO = TYPE.CDO;
var CDC = TYPE.CDC;
var EXCLAMATIONMARK = 0x0021; // U+0021 EXCLAMATION MARK (!)

function consumeRaw(startToken) {
    return this.Raw(startToken, null, false);
=======
var EXCLAMATIONMARK = TYPE.ExclamationMark;
var ATRULE = TYPE.Atrule;
var CDO = TYPE.CDO;
var CDC = TYPE.CDC;

function consumeRaw(startToken) {
    return this.Raw(startToken, 0, 0, false, false);
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
}

module.exports = {
    name: 'StyleSheet',
    structure: {
<<<<<<< HEAD
        children: [[
            'Comment',
            'CDO',
            'CDC',
            'Atrule',
            'Rule',
            'Raw'
        ]]
    },
    parse: function() {
        var start = this.scanner.tokenStart;
        var children = this.createList();
=======
        children: [['Comment', 'Atrule', 'Rule', 'Raw']]
    },
    parse: function() {
        var start = this.scanner.tokenStart;
        var children = new List();
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
        var child;

        scan:
        while (!this.scanner.eof) {
            switch (this.scanner.tokenType) {
                case WHITESPACE:
                    this.scanner.next();
                    continue;

                case COMMENT:
                    // ignore comments except exclamation comments (i.e. /*! .. */) on top level
                    if (this.scanner.source.charCodeAt(this.scanner.tokenStart + 2) !== EXCLAMATIONMARK) {
                        this.scanner.next();
                        continue;
                    }

                    child = this.Comment();
                    break;

                case CDO: // <!--
                    child = this.CDO();
                    break;

                case CDC: // -->
                    child = this.CDC();
                    break;

                // CSS Syntax Module Level 3
                // ยง2.2 Error handling
                // At the "top level" of a stylesheet, an <at-keyword-token> starts an at-rule.
<<<<<<< HEAD
                case ATKEYWORD:
                    child = this.parseWithFallback(this.Atrule, consumeRaw);
=======
                case ATRULE:
                    child = this.Atrule();
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
                    break;

                // Anything else starts a qualified rule ...
                default:
<<<<<<< HEAD
                    child = this.parseWithFallback(this.Rule, consumeRaw);
            }

            children.push(child);
=======
                    child = this.tolerantParse(this.Rule, consumeRaw);
            }

            children.appendData(child);
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
        }

        return {
            type: 'StyleSheet',
            loc: this.getLocation(start, this.scanner.tokenStart),
            children: children
        };
    },
<<<<<<< HEAD
    generate: function(node) {
        this.children(node);
=======
    generate: function(processChunk, node) {
        this.each(processChunk, node);
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
    },
    walkContext: 'stylesheet'
};
