'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _postcss = require('postcss');

var _postcss2 = _interopRequireDefault(_postcss);

var _browserslist = require('browserslist');

var _browserslist2 = _interopRequireDefault(_browserslist);

var _plugins = require('./plugins');

var _plugins2 = _interopRequireDefault(_plugins);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const stylehacks = _postcss2.default.plugin('stylehacks', (opts = {}) => {
    return (css, result) => {
        const resultOpts = result.opts || {};
        const browsers = (0, _browserslist2.default)(null, {
            stats: resultOpts.stats,
            path: __dirname,
            env: resultOpts.env
        });
        const processors = _plugins2.default.reduce((list, Plugin) => {
            const hack = new Plugin(result);
            const applied = browsers.some(browser => {
                return hack.targets.some(target => browser === target);
            });
<<<<<<< HEAD

            if (applied) {
                return list;
            }

            return [...list, hack];
        }, []);

=======
            if (applied) {
                return list;
            }
            return [...list, hack];
        }, []);
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
        css.walk(node => {
            processors.forEach(proc => {
                if (!~proc.nodeTypes.indexOf(node.type)) {
                    return;
                }
<<<<<<< HEAD

                if (opts.lint) {
                    return proc.detectAndWarn(node);
                }

=======
                if (opts.lint) {
                    return proc.detectAndWarn(node);
                }
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
                return proc.detectAndResolve(node);
            });
        });
    };
});

stylehacks.detect = node => {
    return _plugins2.default.some(Plugin => {
        const hack = new Plugin();
<<<<<<< HEAD

=======
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
        return hack.any(node);
    });
};

exports.default = stylehacks;
module.exports = exports['default'];