const { createSchema, validate } = require('@vue/cli-shared-utils')

const schema = createSchema(joi => joi.object({
  baseUrl: joi.string().allow(''),
<<<<<<< HEAD
  publicPath: joi.string().allow(''),
  outputDir: joi.string(),
  assetsDir: joi.string().allow(''),
=======
  outputDir: joi.string(),
  assetsDir: joi.string(),
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
  indexPath: joi.string(),
  filenameHashing: joi.boolean(),
  runtimeCompiler: joi.boolean(),
  transpileDependencies: joi.array(),
  productionSourceMap: joi.boolean(),
<<<<<<< HEAD
  parallel: joi.alternatives().try([
    joi.boolean(),
    joi.number().integer()
  ]),
  devServer: joi.object(),
  pages: joi.object().pattern(
    /\w+/,
    joi.alternatives().try([
      joi.string().required(),
      joi.array().items(joi.string().required()),

      joi.object().keys({
        entry: joi.alternatives().try([
          joi.string().required(),
          joi.array().items(joi.string().required())
        ]).required()
      }).unknown(true)
    ])
  ),
  crossorigin: joi.string().valid(['', 'anonymous', 'use-credentials']),
  integrity: joi.boolean(),
=======
  parallel: joi.boolean(),
  devServer: joi.object(),
  pages: joi.object(),
  corsUseCredentials: joi.boolean(),
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361

  // css
  css: joi.object({
    modules: joi.boolean(),
    extract: joi.alternatives().try(joi.boolean(), joi.object()),
    sourceMap: joi.boolean(),
    loaderOptions: joi.object({
      css: joi.object(),
      sass: joi.object(),
<<<<<<< HEAD
      scss: joi.object(),
=======
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
      less: joi.object(),
      stylus: joi.object(),
      postcss: joi.object()
    })
  }),

  // webpack
  chainWebpack: joi.func(),
  configureWebpack: joi.alternatives().try(
    joi.object(),
    joi.func()
  ),

  // known runtime options for built-in plugins
<<<<<<< HEAD
  lintOnSave: joi.any().valid([true, false, 'error', 'warning', 'default']),
=======
  lintOnSave: joi.any().valid([true, false, 'error']),
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
  pwa: joi.object(),

  // 3rd party plugin options
  pluginOptions: joi.object()
}))

exports.validate = (options, cb) => {
  validate(options, schema, cb)
}

<<<<<<< HEAD
// #2110
// https://github.com/nodejs/node/issues/19022
// in some cases cpus() returns undefined, and may simply throw in the future
function hasMultipleCores () {
  try {
    return require('os').cpus().length > 1
  } catch (e) {
    return false
  }
}

exports.defaults = () => ({
  // project deployment base
  publicPath: '/',
  // for compatibility concern. TODO: remove in v4.
=======
exports.defaults = () => ({
  // project deployment base
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
  baseUrl: '/',

  // where to output built files
  outputDir: 'dist',

  // where to put static assets (js/css/img/font/...)
  assetsDir: '',

  // filename for index.html (relative to outputDir)
  indexPath: 'index.html',

  // whether filename will contain hash part
  filenameHashing: true,

  // boolean, use full build?
  runtimeCompiler: false,

  // deps to transpile
<<<<<<< HEAD
  transpileDependencies: [
    /* string or regex */
  ],
=======
  transpileDependencies: [/* string or regex */],
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361

  // sourceMap for production build?
  productionSourceMap: !process.env.VUE_CLI_TEST,

  // use thread-loader for babel & TS in production build
  // enabled by default if the machine has more than 1 cores
<<<<<<< HEAD
  parallel: hasMultipleCores(),
=======
  parallel: require('os').cpus().length > 1,
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361

  // multi-page config
  pages: undefined,

  // <script type="module" crossorigin="use-credentials">
<<<<<<< HEAD
  // #1656, #1867, #2025
  crossorigin: undefined,

  // subresource integrity
  integrity: false,
=======
  // #1656, #1867
  corsUseCredentials: false,
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361

  css: {
    // extract: true,
    // modules: false,
    // localIdentName: '[name]_[local]_[hash:base64:5]',
    // sourceMap: false,
    // loaderOptions: {}
  },

  // whether to use eslint-loader
  lintOnSave: true,

  devServer: {
<<<<<<< HEAD
    /*
=======
  /*
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
    open: process.platform === 'darwin',
    host: '0.0.0.0',
    port: 8080,
    https: false,
    hotOnly: false,
    proxy: null, // string | Object
    before: app => {}
  */
  }
})
