<<<<<<< HEAD
=======
var List = require('../../utils/list');
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
var TYPE = require('../../tokenizer').TYPE;

var WHITESPACE = TYPE.WhiteSpace;
var COMMENT = TYPE.Comment;
<<<<<<< HEAD
var IDENT = TYPE.Ident;
var FUNCTION = TYPE.Function;
var COLON = TYPE.Colon;
var LEFTPARENTHESIS = TYPE.LeftParenthesis;

function consumeRaw() {
    return this.createSingleNodeList(
        this.Raw(this.scanner.tokenIndex, null, false)
=======
var IDENTIFIER = TYPE.Identifier;
var FUNCTION = TYPE.Function;
var LEFTPARENTHESIS = TYPE.LeftParenthesis;
var HYPHENMINUS = TYPE.HyphenMinus;
var COLON = TYPE.Colon;

function consumeRaw() {
    return new List().appendData(
        this.Raw(this.scanner.currentToken, 0, 0, false, false)
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
    );
}

function parentheses() {
<<<<<<< HEAD
    this.scanner.skipSC();

    if (this.scanner.tokenType === IDENT &&
        this.lookupNonWSType(1) === COLON) {
        return this.createSingleNodeList(
=======
    var index = 0;

    this.scanner.skipSC();

    // TODO: make it simplier
    if (this.scanner.tokenType === IDENTIFIER) {
        index = 1;
    } else if (this.scanner.tokenType === HYPHENMINUS &&
               this.scanner.lookupType(1) === IDENTIFIER) {
        index = 2;
    }

    if (index !== 0 && this.scanner.lookupNonWSType(index) === COLON) {
        return new List().appendData(
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
            this.Declaration()
        );
    }

    return readSequence.call(this);
}

function readSequence() {
<<<<<<< HEAD
    var children = this.createList();
=======
    var children = new List();
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
    var space = null;
    var child;

    this.scanner.skipSC();

    scan:
    while (!this.scanner.eof) {
        switch (this.scanner.tokenType) {
            case WHITESPACE:
                space = this.WhiteSpace();
                continue;

            case COMMENT:
                this.scanner.next();
                continue;

            case FUNCTION:
                child = this.Function(consumeRaw, this.scope.AtrulePrelude);
                break;

<<<<<<< HEAD
            case IDENT:
=======
            case IDENTIFIER:
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
                child = this.Identifier();
                break;

            case LEFTPARENTHESIS:
                child = this.Parentheses(parentheses, this.scope.AtrulePrelude);
                break;

            default:
                break scan;
        }

        if (space !== null) {
<<<<<<< HEAD
            children.push(space);
            space = null;
        }

        children.push(child);
=======
            children.appendData(space);
            space = null;
        }

        children.appendData(child);
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
    }

    return children;
}

module.exports = {
    parse: {
        prelude: function() {
            var children = readSequence.call(this);

<<<<<<< HEAD
            if (this.getFirstListNode(children) === null) {
                this.error('Condition is expected');
=======
            if (children.isEmpty()) {
                this.scanner.error('Condition is expected');
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
            }

            return children;
        },
        block: function() {
            return this.Block(false);
        }
    }
};
