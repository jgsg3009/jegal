<<<<<<< HEAD
=======
'use strict';

>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
var hasOwnProperty = Object.prototype.hasOwnProperty;
var keywords = Object.create(null);
var properties = Object.create(null);
var HYPHENMINUS = 45; // '-'.charCodeAt()

function isCustomProperty(str, offset) {
<<<<<<< HEAD
    offset = offset || 0;

=======
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
    return str.length - offset >= 2 &&
           str.charCodeAt(offset) === HYPHENMINUS &&
           str.charCodeAt(offset + 1) === HYPHENMINUS;
}

function getVendorPrefix(str, offset) {
<<<<<<< HEAD
    offset = offset || 0;

    // verdor prefix should be at least 3 chars length
    if (str.length - offset >= 3) {
        // vendor prefix starts with hyper minus following non-hyper minus
        if (str.charCodeAt(offset) === HYPHENMINUS &&
            str.charCodeAt(offset + 1) !== HYPHENMINUS) {
            // vendor prefix should contain a hyper minus at the ending
            var secondDashIndex = str.indexOf('-', offset + 2);

            if (secondDashIndex !== -1) {
                return str.substring(offset, secondDashIndex + 1);
            }
=======
    if (str.charCodeAt(offset) === HYPHENMINUS) {
        // vendor should contain at least one letter
        var secondDashIndex = str.indexOf('-', offset + 2);

        if (secondDashIndex !== -1) {
            return str.substring(offset, secondDashIndex + 1);
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
        }
    }

    return '';
}

<<<<<<< HEAD
function getKeywordDescriptor(keyword) {
=======
function getKeywordInfo(keyword) {
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
    if (hasOwnProperty.call(keywords, keyword)) {
        return keywords[keyword];
    }

    var name = keyword.toLowerCase();

    if (hasOwnProperty.call(keywords, name)) {
        return keywords[keyword] = keywords[name];
    }

<<<<<<< HEAD
    var custom = isCustomProperty(name, 0);
    var vendor = !custom ? getVendorPrefix(name, 0) : '';

    return keywords[keyword] = Object.freeze({
        basename: name.substr(vendor.length),
        name: name,
        vendor: vendor,
        prefix: vendor,
        custom: custom
    });
}

function getPropertyDescriptor(property) {
=======
    var vendor = !isCustomProperty(name, 0) ? getVendorPrefix(name, 0) : '';

    return keywords[keyword] = Object.freeze({
        vendor: vendor,
        prefix: vendor,
        name: name.substr(vendor.length)
    });
}

function getPropertyInfo(property) {
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
    if (hasOwnProperty.call(properties, property)) {
        return properties[property];
    }

    var name = property;
    var hack = property[0];

    if (hack === '/') {
        hack = property[1] === '/' ? '//' : '/';
    } else if (hack !== '_' &&
               hack !== '*' &&
               hack !== '$' &&
               hack !== '#' &&
<<<<<<< HEAD
               hack !== '+' &&
               hack !== '&') {
=======
               hack !== '+') {
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
        hack = '';
    }

    var custom = isCustomProperty(name, hack.length);

<<<<<<< HEAD
    // re-use result when possible (the same as for lower case)
=======
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
    if (!custom) {
        name = name.toLowerCase();
        if (hasOwnProperty.call(properties, name)) {
            return properties[property] = properties[name];
        }
    }

    var vendor = !custom ? getVendorPrefix(name, hack.length) : '';
<<<<<<< HEAD
    var prefix = name.substr(0, hack.length + vendor.length);

    return properties[property] = Object.freeze({
        basename: name.substr(prefix.length),
        name: name.substr(hack.length),
        hack: hack,
        vendor: vendor,
        prefix: prefix,
=======

    return properties[property] = Object.freeze({
        hack: hack,
        vendor: vendor,
        prefix: hack + vendor,
        name: name.substr(hack.length + vendor.length),
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
        custom: custom
    });
}

module.exports = {
<<<<<<< HEAD
    keyword: getKeywordDescriptor,
    property: getPropertyDescriptor,
    isCustomProperty: isCustomProperty,
    vendorPrefix: getVendorPrefix
=======
    keyword: getKeywordInfo,
    property: getPropertyInfo
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
};
