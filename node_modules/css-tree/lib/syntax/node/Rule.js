var TYPE = require('../../tokenizer').TYPE;
<<<<<<< HEAD
var rawMode = require('./Raw').mode;
=======
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361

var LEFTCURLYBRACKET = TYPE.LeftCurlyBracket;

function consumeRaw(startToken) {
<<<<<<< HEAD
    return this.Raw(startToken, rawMode.leftCurlyBracket, true);
}

function consumePrelude() {
    var prelude = this.SelectorList();

    if (prelude.type !== 'Raw' &&
        this.scanner.eof === false &&
        this.scanner.tokenType !== LEFTCURLYBRACKET) {
        this.error();
    }

    return prelude;
=======
    return this.Raw(startToken, LEFTCURLYBRACKET, 0, false, true);
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
}

module.exports = {
    name: 'Rule',
    structure: {
        prelude: ['SelectorList', 'Raw'],
        block: ['Block']
    },
    parse: function() {
<<<<<<< HEAD
        var startToken = this.scanner.tokenIndex;
=======
        var startToken = this.scanner.currentToken;
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
        var startOffset = this.scanner.tokenStart;
        var prelude;
        var block;

        if (this.parseRulePrelude) {
<<<<<<< HEAD
            prelude = this.parseWithFallback(consumePrelude, consumeRaw);
=======
            prelude = this.tolerantParse(this.SelectorList, consumeRaw);

            if (this.tolerant && !this.scanner.eof) {
                if (prelude.type !== 'Raw' && this.scanner.tokenType !== LEFTCURLYBRACKET) {
                    prelude = consumeRaw.call(this, startToken);
                }
            }
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
        } else {
            prelude = consumeRaw.call(this, startToken);
        }

        block = this.Block(true);

        return {
            type: 'Rule',
            loc: this.getLocation(startOffset, this.scanner.tokenStart),
            prelude: prelude,
            block: block
        };
    },
<<<<<<< HEAD
    generate: function(node) {
        this.node(node.prelude);
        this.node(node.block);
=======
    generate: function(processChunk, node) {
        this.generate(processChunk, node.prelude);
        this.generate(processChunk, node.block);
>>>>>>> 99ef3b4711c8dcd2f717e43dd012712d1f333361
    },
    walkContext: 'rule'
};
